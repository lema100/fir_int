#include "fir_int.h"

const double rect48_minph_kaiser4_fc50[] =
{
	0.0029595,	0.0039390,	0.0050606,	0.0063236,
	0.0077244,	0.0092561,	0.0109083,	0.0126676,
	0.0145170,	0.0164370,	0.0184051,	0.0203965,
	0.0223848,	0.0243419,	0.0262394,	0.0280485,
	0.0297409,	0.0312895,	0.0326691,	0.0338566,
	0.0348321,	0.0355788,	0.0360839,	0.0363387,
	0.0363387,	0.0360839,	0.0355788,	0.0348321,
	0.0338566,	0.0326691,	0.0312895,	0.0297409,
	0.0280485,	0.0262394,	0.0243419,	0.0223848,
	0.0203965,	0.0184051,	0.0164370,	0.0145170,
	0.0126676,	0.0109083,	0.0092561,	0.0077244,
	0.0063236,	0.0050606,	0.0039390,	0.0029595,
};
const double rect32_minph_kaiser2_fc50[] =
{
	0.0170051,	0.0192121,	0.0214370,	0.0236541,
	0.0258367,	0.0279577,	0.0299902,	0.0319078,
	0.0336851,	0.0352981,	0.0367250,	0.0379459,
	0.0389439,	0.0397050,	0.0402185,	0.0404771,
	0.0404771,	0.0402185,	0.0397050,	0.0389439,
	0.0379459,	0.0367250,	0.0352981,	0.0336851,
	0.0319078,	0.0299902,	0.0279577,	0.0258367,
	0.0236541,	0.0214370,	0.0192121,	0.0170051,
};
const double rect32_minph_kaiser6_fc50[] =
{
	0.00187166,	0.00351974,	0.00580243,	0.0087783,
	0.0124677,	0.0168446,	0.0218315,	0.0272984,
	0.0330665,	0.0389165,	0.0446004,	0.049858,
	0.0544336,	0.0580952,	0.060651,	0.0619645,
	0.0619645,	0.060651,	0.0580952,	0.0544336,
	0.049858,	0.0446004,	0.0389165,	0.0330665,
	0.0272984,	0.0218315,	0.0168446,	0.0124677,
	0.0087783,	0.00580243,	0.00351974,	0.00187166,
};

const double rect32_minph_kaiser4_fc50[] =
{
	0.0060104,	0.0085910,	0.0115707,	0.0149126,
	0.0185616,	0.0224454,	0.0264761,	0.0305536,
	0.0345690,	0.0384085,	0.0419585,	0.0451102,
	0.0477643,	0.0498352,	0.0512551,	0.0519771,
	0.0519771,	0.0512551,	0.0498352,	0.0477643,
	0.0451102,	0.0419585,	0.0384085,	0.0345690,
	0.0305536,	0.0264761,	0.0224454,	0.0185616,
	0.0149126,	0.0115707,	0.0085910,	0.0060104,
};

const double rect24_minph_kaiser6_fc50[] =
{
	0.00325954,	0.00676748,	0.01181186,	0.01844913,
	0.02655659,	0.03581518,	0.04571941,	0.05561585,
	0.06476695,	0.07243233,	0.07795637,	0.08084928,
	0.08084928,	0.07795637,	0.07243233,	0.06476695,
	0.05561585,	0.04571941,	0.03581518,	0.02655659,
	0.01844913,	0.01181186,	0.00676748,	0.00325954,
};

const double rect20_minph_kaiser6_fc50[] =
{
	0.00464045,	0.01028374,	0.01856195,	0.02940026,
	0.04227650,	0.05622872,	0.06995458,	0.08199101,
	0.09094339,	0.09571935,	0.09571935,	0.09094339,
	0.08199101,	0.06995458,	0.05622872,	0.04227650,
	0.02940026,	0.01856195,	0.01028374,	0.00464045,
};

const double rect16_minph_kaiser6_fc50[] =
{
	0.00721055,	0.0173029,	0.0323192,	0.0514453,
	0.0726187,	0.0928287,	0.108747,	0.117527,
	0.117527,	0.108747,	0.0928287,	0.0726187,
	0.0514453,	0.0323192,	0.0173029,	0.00721055,
};

void fir_int_init(fir_int_ctx_t *ctx, double *coeff_f, int32_t *coeff_i, uint32_t taps, int16_t *out, uint32_t coeff_depth)
{
	ctx->step = 0;
	ctx->taps = taps;
	ctx->coeff = coeff_i;
	ctx->out = out;
	ctx->coeff_depth = coeff_depth;
	for (uint32_t i = 0; i < ctx->taps; i++)
		ctx->coeff[i] = coeff_f[i] * (1 << ctx->coeff_depth);
}

void fir_int_calc(fir_int_ctx_t *ctx, int16_t *in, uint32_t len)
{
	ctx->step = 0;
	while (len--)
		fir_int_bystep_calc(ctx, in);
}

inline void fir_int_bystep_calc(fir_int_ctx_t *ctx, int16_t *in)
{
	int32_t tmp = 0;
	for (uint32_t j = 0; j < ctx->taps; j++)
		tmp += in[ctx->step - j] * ctx->coeff[j];
	ctx->out[ctx->step] = tmp >> ctx->coeff_depth;
	ctx->step++;
}
